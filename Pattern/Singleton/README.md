# Singleton

# Singleton
プロジェクト内で必ず一つしかインスタンス化されないクラスを作るパターン。  
単語の意味：1枚札の。一つの

## 使い所
- プロジェクト内で一つしかインスタンスとならない場合に、そのことを保証することで、インスタンス間での整合性などを担保することができる。
- システム全体の設定データを管理するクラスなど
- HWとのアクセスを行うクラスなど

## 実装方法
2つの実装方法がある。staticクラスを作れる場合はstaticクラスを使う。
- staticクラス：継承ができない制約がある。
- コンストラクタをprivateにする：コンストラクタをprivateにすることで、コンストラクタの使用タイミングを管理する。 
    - コンストラクタをprivateにする
    - GetInstance()メソッドを用意してインスタンスにアクセスできるようにする。
    - 1回目のアクセス時にインスタンス化を行う
    - staticでクラス自身が自分のインスタンスを保持するようにする
    - 非同期でのアクセスがある場合は、LookObjectなどを使って、アクセスタイミングを制御する。または、プロパティで初期化する。
    
### Pythonの場合
`__new__(cls)`を使って実装する。
    
## ポイント
- newできないようにする -> 他クラスからインスタンス化できないようにする。
- インスタンスにアクセスできないようにする -> GetInstance()などでアクセスを制限する。
- statciクラスが使えるなら使う。
- 非同期処理は気をつける。 -> 複数でアクセスすると不整合やデットロックなどバグになる。
- テストコードでも1つしか無いので、前のテストの影響を受けるので単体テストで考慮が必要。

## テストコードで考慮するべき内容
テストコードの場合に他のテストの影響を受けるため、テストの実施順によってテスト結果が変わる可能性がある。
- テストを実行する前にシングルトンのインスタンスを初期状態にする。  
-> テストイニシャライズなどテストフレームワークにはテスト実行前に必ず実行する処理を書く箇所がある。
- 複数のテストクラスでシングルトンのクラスを使う必要がある場合は、ベースのテストクラスを作成して、各テストクラスで継承することでイニシャライズ処理を複数書く必要がなくなる。 

